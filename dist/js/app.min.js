function formattedDate(e){var t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2),a=e.getFullYear(),o=a+"-"+n+"-"+t;return o}function convertDays(e){var t=new Array(7);t.Monday=1,t.Tuesday=2,t.Wednesday=3,t.Thursday=4,t.Friday=5,t.Saturday=6,t.Sunday=7;var n=t[e];return n}function getClosestDay(e,t){var n=new Date(e.getTime());return n.setDate(e.getDate()+(7+t-e.getDay())%7),n}function dismissInstructions(){var e={action:"dismiss"};jQuery.post(ajaxurl,e)}ImportEvents=ImportEvents||{},ImportEvents.Admin=ImportEvents.Admin||{},ImportEvents.Admin.AcceptDeny=function(e){function t(){e(function(){this.handleEvents()}.bind(this))}return t.prototype.changeAccepted=function(t,n){e.ajax({url:eventmanager.ajaxurl,type:"post",data:{action:"accept_or_deny",value:t,postId:n},beforeSend:function(a){var o=e("#post-"+n);1==t?(o.find(".deny").removeClass("hidden"),o.find(".accept").addClass("hidden")):0==t&&(o.find(".deny").addClass("hidden"),o.find(".accept").removeClass("hidden"))}})},t.prototype.handleEvents=function(){e(document).on("click",".accept",function(n){n.preventDefault();var a=e(n.target).attr("post-id");t.prototype.changeAccepted(1,a)}.bind(this)),e(document).on("click",".deny",function(n){n.preventDefault();var a=e(n.target).attr("post-id");t.prototype.changeAccepted(0,a)}.bind(this))},new t}(jQuery),function(e){"undefined"!=typeof acf&&(acf.add_filter("date_time_picker_args",function(e,t){return e.timeOnlyTitle=eventmanager.choose_time,e.timeText=eventmanager.time,e.hourText=eventmanager.hour,e.minuteText=eventmanager.minute,e.closeText=eventmanager.done,e.currentText=eventmanager.now,e.showSecond=!1,e}),acf.add_filter("time_picker_args",function(e,t){return e.timeOnlyTitle=eventmanager.choose_time,e.timeText=eventmanager.time,e.hourText=eventmanager.hour,e.minuteText=eventmanager.minute,e.closeText=eventmanager.done,e.currentText=eventmanager.now,e.showSecond=!1,e}),acf.add_filter("google_map_marker_args",function(e,t){return e.draggable=!1,e.raiseOnDrag=!1,e}),acf.add_filter("validation_complete",function(t,n){if(e(".acf-tab-error",n).remove(),t.errors)for(var a=0;a<t.errors.length;a++){var o=e('[name="'+t.errors[a].input+'"]',n).parents(".acf-field");o=o[o.length-1];var i=e(o,n).prevAll(".acf-field-tab").attr("data-key");e(".acf-tab-wrap a[data-key="+i+"] .acf-tab-error",n).remove(),e(".acf-tab-wrap a[data-key="+i+"]",n).append(' <span class="dashicons dashicons-warning acf-tab-error"></span>').click()}return t}))}(jQuery),ImportEvents=ImportEvents||{},ImportEvents.Admin=ImportEvents.Admin||{},ImportEvents.Admin.Guide=function(e){function t(){this.locationPicker()}return t.prototype.locationPicker=function(){jQuery(function(e){e(document).on("change","#acf-field_589498b7fc7b3-input",function(){var t=this.getParameterByName("post"),n={action:"update_guide_sublocation_option",selected:e("#acf-field_589498b7fc7b3-input").val(),post_id:t};t?e.post(ajaxurl,n,function(t){var n=e.parseJSON(t);e("[data-name='guide_object_location'] select").each(function(t,a){var o=e(this);if(o.length){var i=o.val();o.empty(),e.each(n,function(t,n){o.append(e("<option/>",{value:t,text:n}).bind(n))}.bind(o)),o.val(i)}})}.bind(this)):alert("Please save the guide to allow sublocations to be selected.")}.bind(this))}.bind(this))},t.prototype.getParameterByName=function(e){var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);if(t)return t[1]||void 0},new t}(jQuery),jQuery(document).ready(function(e){e('#sync-meta-box input[type="checkbox"]').on("change",function(){e('#sync-meta-box input[type="checkbox"]').is(":checked")?(e("body").addClass("no-sync"),e(this).parent().addClass("check_active")):(e("body").removeClass("no-sync"),e(this).parent().removeClass("check_active"))}).trigger("change"),e('.acf-field[data-name="main_organizer"] input[type="checkbox"]').each(function(t,n){e(this).prop("checked")&&e('.acf-field[data-name="main_organizer"]').not(e(this).closest('.acf-field[data-name="main_organizer"]')).addClass("main_organizer_hidden")}),e('.acf-field[data-name="main_organizer"] input[type="checkbox"]').live("click",function(){e(this).prop("checked")?e('.acf-field[data-name="main_organizer"]').not(e(this).closest('.acf-field[data-name="main_organizer"]')).addClass("main_organizer_hidden"):e('.acf-field[data-name="main_organizer"]').removeClass("main_organizer_hidden")}),e(".acf-button").removeClass("button-primary"),e('.acf-field[data-name="geo_map"] .acf-hidden').each(function(t,n){var a=e(this).find(".input-address").attr("value"),o=e(this).find(".input-lat").attr("value"),i=e(this).find(".input-lng").attr("value");a&&o&&i||e('.acf-field[data-name="geo_map"]').hide()}),e(".notice.is-dismissible").on("click",".notice-dismiss",function(e){dismissInstructions()}),e(".acf-gallery-add").text(eventmanager.add_images);var t="";e('input[name="post_title"]').on("change paste keyup",function(){var n=e(this).val();if(n!=t)if(t=n,n.length>3){var a=({action:"check_existing_title",value:n,postType:pagenow},"event"===pagenow),o=a?"/json/wp/v2/"+pagenow+"/search?term="+n:"/json/wp/v2/"+pagenow+"?search="+n;jQuery.get(o,function(t){e("#suggestionList").empty();for(var o in t){var i=t[o].id,r=a?t[o].title:t[o].title.rendered,s=r.replace("<span>","").replace("</span>"),c=new RegExp("("+n+")","igm"),d=s.replace(c,"<span>$1</span>");e("#suggestionList").append('<li><a href="/wp/wp-admin/post.php?post='+i+'&action=edit" class="suggestion">'+d+"</a></li>")}0==e(".suggestion").length?e("#suggestionContainer").fadeOut(200):(e("#suggestionList").prepend("<li><strong>"+eventmanager.similar_posts+': <button class="notice-dismiss suggestion-hide" suggestion-hide-action="close"> </strong></li>'),e("#suggestionContainer").fadeIn(200))})}else e("#suggestionContainer").fadeOut(200)}),e(this).on("click",'[suggestion-hide-action="close"]',function(t){t.preventDefault(),e("#suggestionContainer").fadeOut(200)}),"contact"!=pagenow&&"location"!=pagenow&&"event"!=pagenow&&"sponsor"!=pagenow&&"package"!=pagenow&&"membership-card"!=pagenow||e("#titlewrap").after('<div id="suggestionContainer"><ul id="suggestionList"></ul></div>'),"edit-event"!=pagenow&&"edit-location"!=pagenow||(e("#wpwrap").append('<div id="blackOverlay"></div>'),e(".wrap").append('            <div id="importResponse">                <div><h3>'+eventmanager.new_data_imported+'</h3></div>                <div class="inline"><p><strong>'+eventmanager.events+'</strong></p></div><div class="inline"><p><strong>'+eventmanager.locations+'</strong></p></div><div class="inline"><p><strong>'+eventmanager.contacts+'</strong></p></div>                <div class="inline"><p id="event">0</p></div><div class="inline"><p id="location">0</p></div><div class="inline"><p id="contact">0</p></div>                <div id="untilReload"><div id="meter"></div><p>'+eventmanager.time_until_reload+"</p></div>            </div>        ")),e("body").on("click",".acf-field-576110e583969 .hasDatepicker",function(){var t=e(this).parents(".acf-field-576110e583969").prev().find(".hasDatepicker").val();if(t){var n=t.split(/[ ]+/),a=n[0].split(/[-]+/),o=a[1]-1,t=new Date(a[0],o,a[2],0,0,0);if("[object Date]"===Object.prototype.toString.call(t)&&!isNaN(t.getTime())){var i=t.getFullYear(),r=t.getMonth(),s=t.getDate(),c=new Date(i+1,r,s);e(this).datetimepicker("option","minDate",t),e(this).datetimepicker("option","maxDate",c),e(this).datepicker({showOn:"focus"}).focus()}}}),e("body").on("click",".acf-field-5761169e07309 .hasDatepicker",function(){var t=e(this).parents(".acf-field-5761169e07309").siblings(".acf-field-5761109a83968").find(".hasDatepicker").val();if(t){var n=t.split(/[ ]+/),a=n[0].split(/[-]+/),o=a[1]-1,t=new Date(a[0],o,a[2],0,0,0);if("[object Date]"===Object.prototype.toString.call(t)&&!isNaN(t.getTime())){var i=t.getFullYear(),r=t.getMonth(),s=t.getDate(),c=new Date(i-1,r,s);e(this).datetimepicker("option","minDate",c),e(this).datetimepicker("option","maxDate",t),e(this).datepicker("option","defaultDate",t),e(this).datepicker({showOn:"focus"}).focus()}}}),e("body").on("click",".acf-field-57d279f8db0cc .hasDatepicker",function(){function t(e){var t=jQuery.datepicker.formatDate("yy-mm-dd",e);return[s.indexOf(t)!=-1]}e(this).datepicker("option","dateFormat","yy-mm-dd");var n=e(this).parents(".acf-field-57d279addb0cb").siblings(".acf-field-57d275713bf4e").find(":selected").val(),a=e(this).parents(".acf-field-57d279addb0cb").siblings(".acf-field-57d660a687234").find(".hasDatepicker").val(),o=e(this).parents(".acf-field-57d279addb0cb").siblings(".acf-field-57d2787b3bf51").find(".hasDatepicker").val();if(e(this).datepicker("option","defaultDate",a),a&&o){for(var i=getClosestDay(new Date(a),convertDays(n)),r=new Date(o),s=[],c=new Date(i);c<=r;c.setDate(c.getDate()+7))s.push(formattedDate(new Date(c)));e(this).datepicker("option","beforeShowDay",t)}e(this).datepicker({showOn:"focus"}).focus()}),e("#publish").click(function(){var e=jQuery('[id^="titlediv"]').find("#title");return e.length&&e.val().length<1?(setTimeout("jQuery('#ajax-loading').css('visibility', 'hidden');",100),jQuery(".require-post").length||jQuery("#post").before('<div class="error require-post"><p>'+eventmanager.require_title+"</p></div>"),setTimeout("jQuery('#publish').removeClass('button-primary-disabled');",100),!1):void jQuery(".require-post").remove()}),e("#title").keypress(function(e){if(13==e.which){var t=jQuery('[id^="titlediv"]').find("#title");if(t.val().length<1)return setTimeout("jQuery('#ajax-loading').css('visibility', 'hidden');",100),jQuery(".require-post").length||jQuery("#post").before('<div class="error require-post"><p>'+eventmanager.require_title+"</p></div>"),setTimeout("jQuery('#publish').removeClass('button-primary-disabled');",100),!1;jQuery(".require-post").remove()}})});var ImportEvents=ImportEvents||{};ImportEvents=ImportEvents||{},ImportEvents.Parser=ImportEvents.Parser||{},ImportEvents.Parser.Eventhandling=function(e){function t(){e(function(){e(document).on("click","#xcap",function(n){if(n.preventDefault(),a.value="xcap",!s){s=!0;var o=e(this),i=t.prototype.collectCssFromButton(o);t.prototype.redLoadingButton(o,function(){t.prototype.parseEvents(a,o,i)})}}),e(document).on("click","#cbis",function(n){if(n.preventDefault(),a.value="cbis",!s){s=!0;var o=e(this),i=t.prototype.collectCssFromButton(o);t.prototype.redLoadingButton(o,function(){t.prototype.parseEvents(a,o,i)})}}),e(document).on("click","#cbislocation",function(n){if(n.preventDefault(),a.value="cbislocation",!s){s=!0;var o=e(this),i=t.prototype.collectCssFromButton(o);t.prototype.redLoadingButton(o,function(){t.prototype.parseCbislocation(a,o,i)})}}),e(document).on("click","#occasions",function(n){if(n.preventDefault(),!s){s=!0;var a=e(this),o=t.prototype.collectCssFromButton(a);t.prototype.redLoadingButton(a,function(){var e={action:"collect_occasions"};jQuery.post(ajaxurl,e,function(e){console.log(e),s=!1,t.prototype.restoreButton(a,o)})})}})}.bind(this))}var n={events:0,locations:0,contacts:0},a={action:"import_events",value:"",api_keys:"",cron:!1},o=200,i=400,r=null,s=!1,c=0,d=0;return t.prototype.parseEvents=function(a,o,i){return"cbis"===a.value?a.api_keys=cbis_ajax_vars.cbis_keys[c]:"xcap"===a.value&&(a.api_keys=xcap_ajax_vars.xcap_keys[c]),"undefined"==typeof a.api_keys?(s=!1,void(a.cron||(t.prototype.dataPopUp(n),t.prototype.restoreButton(o,i)))):void e.ajax({url:eventmanager.ajaxurl,type:"post",data:a,success:function(e){console.log(e),n.events+=e.events,n.locations+=e.locations,n.contacts+=e.contacts,c++,t.prototype.parseEvents(a,o,i)}})},t.prototype.parseCbislocation=function(a,o,i){return d=0,"undefined"==typeof cbis_ajax_vars.cbis_keys[c]?(s=!1,void(a.cron||(t.prototype.dataPopUp(n),t.prototype.restoreButton(o,i)))):(a.api_keys=cbis_ajax_vars.cbis_keys[c],void e.when(t.prototype.parseLocations(a)).then(function(){c++,t.prototype.parseCbislocation(a,o,i)}))},t.prototype.parseLocations=function(n){var a=e.Deferred();return t.prototype.parse=function(){return"undefined"==typeof n.api_keys.cbis_locations[d]?void a.resolve():(n.cbis_location=n.api_keys.cbis_locations[d],void e.when(t.prototype.parseLocationCategory(n)).then(function(){d++,t.prototype.parse(n)}))},t.prototype.parse(),a.promise()},t.prototype.parseLocationCategory=function(t){return e.ajax({url:eventmanager.ajaxurl,type:"post",data:t,success:function(e){console.log(e),n.events+=e.events,n.locations+=e.locations,n.contacts+=e.contacts}})},t.prototype.dataPopUp=function(t){e("#blackOverlay").show();var n=e("#importResponse");n.show(500,function(){var e=n.find("#event"),a=n.find("#location"),r=n.find("#contact"),s=e.css("fontSize"),c="26px";e.text(t.events),a.text(t.locations),r.text(t.contacts),e.animate({opacity:1},i).animate({fontSize:c},o).animate({fontSize:s},o,function(){a.animate({opacity:1},i).animate({fontSize:c},o).animate({fontSize:s},o,function(){r.animate({opacity:1},i).animate({fontSize:c},o).animate({fontSize:s},o,function(){var e=n.find("#untilReload #meter");e.animate({width:"100%"},7e3,function(){location.reload()})})})})})},t.prototype.collectCssFromButton=function(e){return{bgColor:e.css("background-color"),textColor:e.css("color"),borderColor:e.css("border-color"),textShadow:e.css("text-shadow"),boxShadow:e.css("box-shadow"),width:e.css("width"),text:e.text()}},t.prototype.redLoadingButton=function(e,t){e.fadeOut(500,function(){var n=[eventmanager.loading+"&nbsp;&nbsp;&nbsp;",eventmanager.loading+".&nbsp;&nbsp;",eventmanager.loading+"..&nbsp;",eventmanager.loading+"..."];e.css("background-color","rgb(51, 197, 255)"),e.css("border-color","rgb(0, 164, 230)"),e.css("color","white"),e.css("text-shadow","0 -1px 1px rgb(0, 164, 230),1px 0 1px rgb(0, 164, 230),0 1px 1px rgb(0, 164, 230),-1px 0 1px rgb(0, 164, 230)"),e.css("box-shadow","none"),e.css("width","85px"),e.html(n[0]),e.fadeIn(500);var a=1;r=setInterval(function(){a>3&&(a=0),e.html(n[a]),++a},500),void 0!=t&&t()})},t.prototype.restoreButton=function(e,t){e.fadeOut(500,function(){e.css("background-color",t.bgColor),e.css("color",t.textColor),e.css("border-color",t.borderColor),e.css("text-shadow",t.textShadow),e.css("box-shadow",t.boxShadow),e.css("width",t.width),e.text(t.text),e.fadeIn(500),clearTimeout(r)})},new t}(jQuery),ImportEvents=ImportEvents||{},ImportEvents.Prompt=ImportEvents.Prompt||{},ImportEvents.Prompt.Modal=function(e){function t(){e(function(){this.handleEvents()}.bind(this))}var n=!1;return t.prototype.open=function(t,a){e("body").addClass("lightbox-open").append('            <div id="lightbox">                <div class="lightbox-wrapper">                    <button class="lightbox-close" data-lightbox-action="close">&times; '+eventmanager.close+'</button>                    <iframe class="lightbox-iframe" src="'+t+'" frameborder="0" allowtransparency></iframe>                </div>            </div>        '),"undefined"!=typeof a&&e(".lightbox-iframe").bind("load",function(){var t=e(this).contents().find("#post");t.append('<input type="hidden" id="parentId" name="parentId" value="'+a+'" />')}),n=!0},t.prototype.close=function(){e(".lightbox-iframe");e("body").removeClass("lightbox-open"),e("#lightbox").remove(),n=!1},t.prototype.handleEvents=function(){e(document).on("click",'[data-lightbox-action="close"]',function(e){e.preventDefault(),this.close()}.bind(this))},new t}(jQuery),ImportEvents=ImportEvents||{},ImportEvents.Admin=ImportEvents.Admin||{},ImportEvents.Admin.NewPostModal=function(e){function t(){e(function(){this.createTrigger("location",".acf-field-576117c423a52"),this.createTrigger("contact",".acf-field-57ebb807988f8"),this.createTrigger("sponsor",".acf-field-57a9d5f3804e1"),this.createTrigger("membership-card",".acf-field-57c7ed92054e6"),this.createTrigger("membership-card",".acf-field-581847f9642dc"),this.bindLaunchModal()}.bind(this))}return t.prototype.createTrigger=function(t,n){e(n).length&&"undefined"!=typeof eventmanager["new_"+t]&&e(n).append('<a class="createNewPost button" href="//'+window.location.host+"/wp/wp-admin/post-new.php?post_type="+t+'&lightbox=true">'+eventmanager["new_"+t]+"</a>")},t.prototype.bindLaunchModal=function(){e(document).on("click",".createNewPost",function(t){t.preventDefault(),ImportEvents.Prompt.Modal.open(e(this).attr("href"),e("#post_ID").val())})},new t}(jQuery);